package app;

import static spark.Spark.*;

import java.util.HashMap;

import dao.UsuarioDAO;
import model.Usuario;
import spark.ModelAndView;
import spark.Request;
import spark.Response;
import spark.template.velocity.VelocityTemplateEngine;

public class HelloWorld {

	public static void main(String[] args) {
		port(4568);
		UsuarioDAO dao = new UsuarioDAO();
		dao.getAll();
		VelocityTemplateEngine vte = new VelocityTemplateEngine();
		staticFiles.location("/public");
        get("/cadastro", HelloWorld::cadastro, vte);
        post("/cadastro", HelloWorld::generateCadastro);
        get("/login", HelloWorld::login, vte);
    }
	
	public static ModelAndView login(Request req, Response res) {
		HashMap<String, Object> model = new HashMap<>();
		
		return new ModelAndView(model, "view/login.vm");
	}
	
	public static ModelAndView cadastro(Request req, Response res) {
		HashMap<String, Object> model = new HashMap<>();
		
		return new ModelAndView(model, "view/cadastro.vm");
	}
	
	public static Object generateCadastro(Request req, Response res) {
		String nome = req.queryParams("nome");
		String email = req.queryParams("email");
		String password = req.queryParams("password");
		System.out.println(nome + " " + email + " " + password);
		UsuarioDAO dao = new UsuarioDAO();
		dao.databaseConnection();
		dao.insert(new Usuario(nome, email, password));
		res.redirect("/login");
		return "ok";
	}
}
